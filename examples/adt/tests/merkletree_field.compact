// This file is part of Compact.
// Copyright (C) 2025 Midnight Foundation
// SPDX-License-Identifier: Apache-2.0
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// 	http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

//PM-14807
import CompactStandardLibrary;

ledger path: MerkleTreePath<4, Field>;

ledger merkleTree: MerkleTree<4, Field>;

ledger fakeRoot: MerkleTree<2, Field>;

ledger merkleTreeSmall: MerkleTree<2, Field>;

ledger partialTree: MerkleTree<4, Field>;

export circuit test(): [] {
  // Initialize a Merkle tree of depth 4 with Field as value_type

  // Test: check_root returns true for a valid root
  const digest = merkleTreePathRoot<4, Field>(path);
  assert(merkleTree.checkRoot(digest) == true, "valid root");

  // Test: check_root returns false for an invalid root
  assert(merkleTree.checkRoot(digest) == false, "invalid root");

  // Test: insert_hash adds a hash and updates the root
  const hash = pad(32, "hash");
  merkleTree.insertHash(hash);

  // Test: insert_hash_index adds a hash at a specific index
  const hashIndex = 2;
  merkleTree.insertHashIndex(hash, hashIndex);

  // Test: insert_index adds a value at a specific index
  const index = 1;
  merkleTree.insertIndex(7, index);

  // Test: insert_index_default inserts default value at a specific index
  const defaultIndex = 3;
  merkleTree.insertIndexDefault(defaultIndex);

  // Test: is_full returns true when the tree is full
  for (const i of 0..4) {
    merkleTreeSmall.insert(i);
  }
  assert(merkleTreeSmall.isFull() == true, "tree is full");

  // Test: is_full returns false when the tree is not full
  assert(partialTree.isFull() == false, "tree is not full");

  // Test: reset_to_default resets the tree to its empty state
  partialTree.insert(42);
  partialTree.resetToDefault();
  assert(partialTree.isFull() == false, "tree is not full");

  // Test: insert after reset_to_default allows adding values again
  partialTree.insert(100);

  return;
}
